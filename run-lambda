#!/bin/bash
# Quick runner for Lambda projects
# Usage: ./run-lambda <project-name> [simple|full] [model-size]
#
# Examples:
#   ./run-lambda my-api              # Full lambda API with 3b model
#   ./run-lambda my-func simple      # Simple single lambda with 1.5b
#   ./run-lambda my-api full 7b      # Full API with 7b model

set -e

PROJECT="${1:-lambda-project}"
TYPE="${2:-full}"
SIZE="${3:-3b}"

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PROJECT_DIR="$SCRIPT_DIR/projects/$PROJECT"

# Select task file based on type
if [ "$TYPE" = "simple" ]; then
    TASKS="$SCRIPT_DIR/templates/lambda-simple-tasks.md"
    # Use smaller model for simple tasks
    [ "$SIZE" = "3b" ] && SIZE="1.5b"
else
    TASKS="$SCRIPT_DIR/templates/aws-lambda-tasks.md"
fi

MODEL="ollama/qwen2.5-coder:$SIZE"

echo "========================================"
echo "Lambda Project Builder"
echo "========================================"
echo "Project:  $PROJECT_DIR"
echo "Type:     $TYPE"
echo "Model:    $MODEL"
echo "Tasks:    $TASKS"
echo "========================================"
echo ""

# Run overnight
exec python3 "$SCRIPT_DIR/overnight.py" \
    --project "$PROJECT_DIR" \
    --tasks "$TASKS" \
    --model "$MODEL" \
    "$@"
